(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d175b95"],{"00b4":function(t,e,s){"use strict";s("ac1f");var n=s("23e7"),a=s("da84"),r=s("c65b"),i=s("e330"),c=s("1626"),o=s("861d"),u=function(){var t=!1,e=/[ac]/;return e.exec=function(){return t=!0,/./.exec.apply(this,arguments)},!0===e.test("abc")&&t}(),l=a.Error,b=i(/./.test);n({target:"RegExp",proto:!0,forced:!u},{test:function(t){var e=this.exec;if(!c(e))return b(this,t);var s=r(e,this,t);if(null!==s&&!o(s))throw new l("RegExp exec method returned something other than an Object or null");return!!s}})},2909:function(t,e,s){"use strict";function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,n=new Array(e);s<e;s++)n[s]=t[s];return n}function a(t){if(Array.isArray(t))return n(t)}s.d(e,"a",(function(){return o}));s("a4d3"),s("e01a"),s("d3b7"),s("d28b"),s("3ca3"),s("ddb0"),s("a630");function r(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}s("fb6a"),s("b0c0"),s("ac1f"),s("00b4");function i(t,e){if(t){if("string"===typeof t)return n(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);return"Object"===s&&t.constructor&&(s=t.constructor.name),"Map"===s||"Set"===s?Array.from(t):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(t,e):void 0}}function c(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t){return a(t)||r(t)||i(t)||c()}},3519:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chatroom-page chat-feature-page"},[s("section",{staticClass:"center-view"},[s("login-users",{attrs:{"chat-bubbles":t.chatBubbles}}),s("chat-window",{attrs:{"chat-bubbles":t.chatBubbles,"is-processing":t.isProcessing},on:{"after-form-submit":t.emitMessageToSocket}})],1)])},a=[],r=s("2909"),i=s("5530"),c=(s("b0c0"),s("d81d"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"login-users"},[s("div",{staticClass:"banner page-name-banner"},[s("div",{staticClass:"banner__other-page d-flex"},[s("span",{staticClass:"banner__other-page__info"},[s("h2",[t._v("上線使用者 ("+t._s(t.userCount)+")")])])])]),s("div",{staticClass:"login-users"},t._l(t.loginUsers,(function(e){return s("div",{key:e.id,staticClass:"login-users__list d-flex"},[s("span",[s("router-link",{attrs:{to:{name:"user",params:{id:e.id}}}},[s("img",{staticClass:"login-users__avatar avatar-50",attrs:{src:e.avatar,alt:""}})])],1),s("div",{staticClass:"login-users__name d-flex"},[s("p",{staticClass:"user-name-text",on:{click:function(s){return s.preventDefault(),s.stopPropagation(),t.toUserPage(e.id)}}},[t._v(" "+t._s(e.name)+" ")]),s("p",{staticClass:"user-account-text"},[t._v(" "+t._s(t._f("accountTag")(e.account))+" ")])])])})),0)])}),o=[],u=(s("4de4"),s("d3b7"),s("2708")),l=s("2f62"),b={name:"Login-users",mixins:[u["a"]],data:function(){return{loginUsers:[]}},computed:Object(i["a"])(Object(i["a"])({},Object(l["b"])(["currentUser"])),{},{userCount:function(){var t=this.loginUsers.length;return t}}),created:function(){var t=this;this.loginUsers=[{id:this.currentUser.id,account:this.currentUser.account,name:this.currentUser.name,avatar:this.currentUser.avatar}],this.sockets.subscribe("onlineHint",(function(e){t.loginUsers.push(e)})),this.sockets.subscribe("offlineHint",(function(e){t.loginUsers=t.loginUsers.filter((function(t){return t.id!==e.id}))}))},methods:{toUserPage:function(t){this.$router.push({name:"user",params:{id:t}})}},sockets:{onlineHint:function(){},offlineHint:function(){}}},h=b,d=s("2877"),f=Object(d["a"])(h,c,o,!1,null,null,null),m=f.exports,_=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("section",{staticClass:"chat-window"},[t._m(0),s("div",{staticClass:"wrapper"},[s("div",{staticClass:"message-container"},t._l(t.chatBubbles,(function(e){return s("div",{key:e.data.eventId,staticClass:"message-container__chat-bubble"},["status"===e.bubbleType?s("div",{staticClass:"message-container__chat-bubble__status-pill"},[t._v(" "+t._s(t._f("loginNotification")(e.data))+" ")]):t._e(),"message"===e.bubbleType?[e.data.User.id!==t.currentUser.id?s("div",{staticClass:"message-container__chat-bubble__received-message"},[s("router-link",{attrs:{to:{name:"user",params:{id:e.data.User.id}}}},[s("img",{staticClass:"\n                  message-container__chat-bubble__received-message__avatar\n                ",attrs:{src:e.data.User.avatar}})]),s("div",{staticClass:"\n                message-container__chat-bubble__received-message__info-wrapper\n              "},[s("div",{staticClass:"\n                  message-container__chat-bubble__received-message__info-wrapper__chat-content\n                "},[t._v(" "+t._s(e.data.content)+" ")]),s("div",{staticClass:"\n                  message-container__chat-bubble__received-message__info-wrapper__time\n                "},[t._v(" "+t._s(t._f("timeFormatToShort")(e.data.createdAt))+" ")])])],1):t._e(),e.data.User.id===t.currentUser.id?s("div",{staticClass:"message-container__chat-bubble__message-sent"},[s("div",{staticClass:"\n                message-container__chat-bubble__message-sent__chat-content\n              "},[t._v(" "+t._s(e.data.content)+" ")]),s("div",{staticClass:"message-container__chat-bubble__message-sent__time"},[t._v(" "+t._s(t._f("timeFormatToShort")(e.data.createdAt))+" ")])]):t._e()]:t._e()],2)})),0)]),s("div",{staticClass:"chat-input-box"},[s("form",{staticClass:"chat-input-box__form",attrs:{action:""},on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleFormSubmit.apply(null,arguments)}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.chatInput,expression:"chatInput"}],staticClass:"chat-input-box__form__input",attrs:{type:"text",placeholder:"輸入訊息 ..."},domProps:{value:t.chatInput},on:{input:function(e){e.target.composing||(t.chatInput=e.target.value)}}}),s("button",{staticClass:"chat-input-box__form__send-btn",attrs:{disabled:t.isProcessing,type:"submit"}})])])])},p=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chatroom-banner"},[s("h2",[t._v("公開聊天室")])])}],g=(s("498a"),{mixins:[u["f"]],props:{chatBubbles:{type:Array},isProcessing:{type:Boolean,default:!1}},data:function(){return{chatInput:""}},computed:Object(i["a"])({},Object(l["b"])(["currentUser"])),filters:{loginNotification:function(t){return"online"===t.status?t.name+" 上線":t.name+" 下線"}},mounted:function(){this.scrollBottom()},methods:{handleFormSubmit:function(){console.log("送出訊息",this.chatInput),this.chatInput.trim().length>0&&(this.$emit("after-form-submit",{input:this.chatInput}),this.chatInput=""),this.scrollBottom()},scrollBottom:function(){var t=document.querySelector(".wrapper");t.scrollTop=t.scrollHeight}}}),v=g,y=Object(d["a"])(v,_,p,!1,null,null,null),C=y.exports,U={name:"Chatroom",components:{LoginUsers:m,ChatWindow:C},data:function(){return{chatBubbles:[],isProcessing:!1}},computed:Object(i["a"])({},Object(l["b"])(["currentUser"])),created:function(){this.$socket.emit("onlineHint",{name:this.currentUser.name,user:{id:this.currentUser.id,account:this.currentUser.account,avatar:this.currentUser.avatar}}),this.fetchHistoryMessages(),this.catchOnlineHint(),this.catchOfflineHint(),this.catchMessage()},methods:{fetchHistoryMessages:function(){var t=this;this.sockets.subscribe("getChatHistory",(function(e){var s,n=e.map((function(t){return{bubbleType:"message",data:Object(i["a"])(Object(i["a"])({},t),{},{eventId:t.id})}}));(s=t.chatBubbles).push.apply(s,Object(r["a"])(n)),console.log("chatBubbles Array:",t.chatBubbles)}))},catchOnlineHint:function(){var t=this;this.sockets.subscribe("onlineHint",(function(e){console.log(e,"上線此資料將被儲存");var s={bubbleType:"status",data:Object(i["a"])(Object(i["a"])({},e),{},{status:"online",eventId:"online"+e.id})};t.chatBubbles.push(s),console.log("chatBubbles Array:",t.chatBubbles)}))},catchOfflineHint:function(){var t=this;this.sockets.subscribe("offlineHint",(function(e){console.log(e,"離線此資料將被儲存");var s={bubbleType:"status",data:Object(i["a"])(Object(i["a"])({},e),{},{status:"offline",eventId:"offline"+e.id})};t.chatBubbles.push(s),console.log("chatBubbles Array:",t.chatBubbles)}))},emitMessageToSocket:function(t){var e=t.input;this.isProcessing=!0,console.log("1 -- function -- view is going to sent ".concat(e," to socket")),this.$socket.emit("getMessage",{content:e,user:{id:this.currentUser.id,name:this.currentUser.name,avatar:this.currentUser.avatar,account:this.currentUser.account}}),this.isProcessing=!1},catchMessage:function(){var t=this;this.sockets.subscribe("getMessage",(function(e){var s={bubbleType:"message",data:Object(i["a"])(Object(i["a"])({},e),{},{eventId:e.id})};t.chatBubbles.push(s),console.log("chatBubbles Array:",t.chatBubbles)}))}},sockets:{onlineHint:function(t){console.log("已進入聊天室",t)},offlineHint:function(t){console.log("已離開聊天室",t)},getMessage:function(t){console.log("2 -- 接收 -- 有新消息",t)},getChatHistory:function(t){console.log("得到 msg 歷史資料",t)}}},w=U,x=Object(d["a"])(w,n,a,!1,null,null,null);e["default"]=x.exports},"4df4":function(t,e,s){"use strict";var n=s("da84"),a=s("0366"),r=s("c65b"),i=s("7b0b"),c=s("9bdd"),o=s("e95a"),u=s("68ee"),l=s("07fa"),b=s("8418"),h=s("9a1f"),d=s("35a1"),f=n.Array;t.exports=function(t){var e=i(t),s=u(this),n=arguments.length,m=n>1?arguments[1]:void 0,_=void 0!==m;_&&(m=a(m,n>2?arguments[2]:void 0));var p,g,v,y,C,U,w=d(e),x=0;if(!w||this==f&&o(w))for(p=l(e),g=s?new this(p):f(p);p>x;x++)U=_?m(e[x],x):e[x],b(g,x,U);else for(y=h(e,w),C=y.next,g=s?new this:[];!(v=r(C,y)).done;x++)U=_?c(y,m,[v.value,x],!0):v.value,b(g,x,U);return g.length=x,g}},"9bdd":function(t,e,s){var n=s("825a"),a=s("2a62");t.exports=function(t,e,s,r){try{return r?e(n(s)[0],s[1]):e(s)}catch(i){a(t,"throw",i)}}},a630:function(t,e,s){var n=s("23e7"),a=s("4df4"),r=s("1c7e"),i=!r((function(t){Array.from(t)}));n({target:"Array",stat:!0,forced:i},{from:a})},d28b:function(t,e,s){var n=s("746f");n("iterator")},fb6a:function(t,e,s){"use strict";var n=s("23e7"),a=s("da84"),r=s("e8b5"),i=s("68ee"),c=s("861d"),o=s("23cb"),u=s("07fa"),l=s("fc6a"),b=s("8418"),h=s("b622"),d=s("1dde"),f=s("f36a"),m=d("slice"),_=h("species"),p=a.Array,g=Math.max;n({target:"Array",proto:!0,forced:!m},{slice:function(t,e){var s,n,a,h=l(this),d=u(h),m=o(t,d),v=o(void 0===e?d:e,d);if(r(h)&&(s=h.constructor,i(s)&&(s===p||r(s.prototype))?s=void 0:c(s)&&(s=s[_],null===s&&(s=void 0)),s===p||void 0===s))return f(h,m,v);for(n=new(void 0===s?p:s)(g(v-m,0)),a=0;m<v;m++,a++)m in h&&b(n,a,h[m]);return n.length=a,n}})}}]);
//# sourceMappingURL=chunk-1d175b95.d87f8809.js.map